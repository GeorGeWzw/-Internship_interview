# <div align='center' ><font size='40'>泰康实习 学习路线</font></div>

## :flashlight: ETL学习

### :star: 1.目标（2020.07.03—）
+ Kettle学习：四个组件；源码；官网
+ 实现Mysql，Oracle，DB2,MongoDB，NoSQL等主流数据库的数据集成
+ 做出结果，到最后报表展示。后期考虑高可用，高容灾

### :scissors: 2.ETL背景

+ 数据仓库（DW）
+ 决策支持系统（DSS）
+ 在线分析处理（OLAP）
+ 数据挖掘（DM）
+ 商业智能（BI）
+ 操作型数据存储(ODS)

&emsp;&emsp;ETL的设计分三部分：数据抽取、数据的清洗转换、数据的加载。数据的抽取是从各个不同的数据源抽取到 **ODS(Operational Data Store，操作型数据存储)** 中，这个过程也可以做一些数据的清洗和转换)，在抽取的过程中需要挑选不同的抽取方法，尽可能的提高ETL的运行效率。ETL三个部分中，花费时间最长的是“T”(Transform，清洗、转换)的部分，一般情况下这部分工作量是整个ETL的2/3。数据的加载一般在数据清洗完了之后直接写入 **DW(Data Warehousing，数据仓库)** 中去。

&emsp;&emsp;ETL包含ETL或是ELT（Extract-Load-Transform），并且混合使用。通常愈大量的数据、复杂的转换逻辑、目的端为较强运算能力的数据库，愈偏向使用ELT，以便运用目的端数据库的平行处理能力。

> ETL的实现有多种方法，常用的有三种。
> + 一种是借助ETL工具(如Oracle的OWB、SQL Server 2000的DTS、SQL Server2005的SSIS服务、Informatic等)实现，借助工具可以快速的建立起ETL工程，屏蔽了复杂的编码任务，提高了速度，降低了难度，但是缺少灵活性。
> + 一种是SQL方式实现,SQL的方法优点是灵活，提高ETL运行效率，但是编码复杂，对技术要求比较高。
> + 一种是ETL工具和SQL相结合。是综合了前面二种的优点，会极大地提高ETL的开发速度和效率。

#### 2.1 数据抽取Extract
&emsp;&emsp;首先要搞清楚数据是从几个业务系统中来,各个业务系统的数据库服务器运行什么DBMS,是否存在手工数据，手工数据量有多大，是否存在非结构化的数据等等，当收集完这些信息之后才可以进行数据抽取的设计。
+ 对于与存放DW的数据库系统相同的数据源：DBMS(SQLServer、Oracle)都会提供数据库链接功能，在DW数据库服务器和原业务系统之间建立直接的链接关系就可以写Select 语句直接访问。
+ 对于与DW数据库系统不同的数据源的处理方法：通过ODBC的方式建立数据库链接。如果不能建立数据库链接，通过工具将源数据导出成.txt或者是.xls文件，然后再将这些源系统文件导入到ODS中。或通过程序接口来完成。
+ 对于文件类型数据源(.txt,.xls)：人工利用数据库工具将这些数据导入到指定的数据库。
+ 注意增量更新

#### 2.2 数据的清洗转换（Cleaning、Transform）
&emsp;&emsp;通常的做法是从业务系统到ODS做清洗，将脏数据和不完整数据过滤掉，在从ODS到DW的过程中转换，进行一些业务规则的计算和聚合。

***数据清洗***:
+ 不完整数据（导出后相关人员补充再录入）；
+ 错误数据（sql，人工）；
+ 重复数据。

> 数据清洗是一个反复的过程，只有不断的发现问题，解决问题。对于是否过滤，是否修正一般要求客户确认，对于过滤掉的数据，写入Excel文件或者将过滤数据写入数据表，在ETL开发的初期可以每天向业务单位发送过滤数据的邮件，促使他们尽快地修正错误,同时也可以做为将来验证数据的依据。

***数据转换***：
+ 不一致数据转换：这个过程是一个整合的过程，将不同业务系统的相同类型的数据统一，统一格式，编码。
+ 数据粒度的转换：业务系统一般存储非常明细的数据，而数据仓库中数据是用来分析的，不需要非常明细的数据。一般情况下，会将业务系统数据按照数据仓库粒度进行聚合。
+ 商务规则的计算：不同的企业有不同的业务规则、不同的数据指标，需要在ETL中将这些数据指标计算好了之后存储在数据仓库中，以供分析使用。

#### 2.3 日志，警告
+ 执行过程日志，这一部分日志是在ETL执行过程中每执行一步的记录，记录每次运行每一步骤的起始时间，影响了多少行数据，流水账形式。
+ 错误日志，当某个模块出错的时候写错误日志，记录每次出错的时间、出错的模块以及出错的信息等。
+ 总体日志，只记录ETL开始时间、结束时间是否成功信息。如果使用ETL工具,ETL工具会自动产生一些日志，这一类日志也可以作为ETL日志的一部分。

> 如果ETL出错了，不仅要形成ETL出错日志，而且要向系统管理员发送警告。发送警告的方式多种，一般常用的就是给系统管理员发送邮件，并附上出错的信息，方便管理员排查错误。


#### 2.4 一些系统参考
昊合ETL开发平台————[系统架构，功能](http://www.haohedi.com/webpage/productIntro.html)

## :nut_and_bolt: Kettle

### 1.组成
名称|描述
:-:|:-:
Spoon|通过图形接口，用于编辑作业和转换的桌面应用。
Pan|一个独立的命令行程序，用于执行由Spoon编辑的转换和作业。
Kitchen|一个独立的命令行程序，用于执行由Spoon编辑的作业。
Carte|Carte是一个轻量级的Web容器，用于建立专用、远程的ETL Server。

### 2. 文档
+ documents[--链接](https://wiki.pentaho.com/display/EAI/Latest+Pentaho+Data+Integration+%28aka+Kettle%29+Documentation)
+ Java API example[--链接](https://wiki.pentaho.com/display/EAI/Pentaho+Data+Integration+-+Java+API+Examples)
+ 源码[--链接](https://github.com/pentaho/pentaho-kettle/tree/9.0.0.0-R)
+ PDI系统[--链接](https://community.hitachivantara.com/s/article/data-integration-kettle)

### 3.踩坑（暂时放弃源码部署，问题太多了，TODO）
+ 源码部署踩坑：java jdk环境变量没配置,maven导入时报错No compiler is provided in this environment. Perhaps you are running on a JRE rather than JDK？注意是java jdk的环境变量，不是IDEA的
+ 部署的一些常见异常[--链接](https://www.e-learn.cn/topic/3193741)
+ EventManager这个类全局搜索时勾选“inclued non-project items"
+ 用8.x的版本重新试试[--链接1](https://blog.csdn.net/ifu25/article/details/103239489?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase)[--链接2](https://blog.csdn.net/gongchengshiv/article/details/105211351)

### 4.连接mysql
+ 驱动用有drive.javad的，也就是5.x.x
+ mysql 8，常规链接有坑，配置data-integration\simple-jndi\jdbc.properties,后面加上
```
    heizhou/type=javax.sql.DataSource
    heizhou/driver=com.mysql.cj.jdbc.Driver
    heizhou/url=jdbc:mysql://localhost:3306/xxxx?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=GMT // xxxx数据库名称
    heizhou/user=root 
    heizhou/password=xxxx  //密码
```
+ 选择方式jnbi。但是这样连接一次后JDBC方式就可以了，原因未知

### 5.基本操作
+ 简单抽取输出文本（txt）[--链接](https://blog.csdn.net/Auspicious_air/article/details/89850822)；文本读入数据库[--链接](https://blog.csdn.net/u013991521/article/details/52459431)
+ 同源数据库之间数据的抽取集成，读取后输出中插入更新，[--参考](https://blog.csdn.net/qqfo24/article/details/82190535)
+ oracle与mysql数据库之间数据迁移[--参考](https://blog.csdn.net/warrah/article/details/80197120)
+ 家里两台电脑数据库互连[--参考](https://blog.csdn.net/qq_36431281/article/details/88072719)

### 6.lunux部署
+ 图形界面问题[--参考](https://blog.csdn.net/JsongNeu/article/details/100063051)


##  :mailbox: Oracle使用
+ 利用navicat可视化[--参考](https://www.cnblogs.com/braveym/p/9501249.html)
+ 用户名是system，密码包括大小写
+ 新建表空间[--参考](https://www.pianshen.com/article/595151024/)
+ 新建表[--参考](https://blog.csdn.net/qq_42914528/article/details/81509853)

## :cloud: Docker
> &emsp;&emsp;Docker 是一个开源的应用容器引擎，基于 Go 语言,可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。
+ 测试docker容器:kettle_test,只装了`mysql8`
+ docker的安装和入门 [--参考](https://blog.csdn.net/zzq060143/article/details/91050272)
+ docker常用命令 [--参考](https://www.cnblogs.com/DeepInThought/p/10896790.html)
+ 修改默认镜像安装位置（还没改）[--参考](https://www.cnblogs.com/brock0624/p/9792203.html)

## :postbox: MongoDB
+ Ubuntu配置 （sudo systemctl restart mongodb重启） [--参考](https://blog.csdn.net/qq_41264674/article/details/90710697)
+ mongo常用命令集合  [--参考](https://www.cnblogs.com/--smile/p/11055204.html)
+ mongo用户创建  [--参考](https://www.cnblogs.com/sz-wenbin/p/11010403.html)
+ windows下docker部署mongoDB [--参考](https://blog.csdn.net/tryll/article/details/99696123）
+ 踩坑：不用他提供的monetdb，自己下载mongodb-driver3.9.1 [--参考](https://blog.csdn.net/pilipalapi/article/details/79207319）
+ mongodb与mysql数据互通 [--参考](https://www.cnblogs.com/skyrim/p/7456135.html）
+ mysql的增量数据导入mongodb [--参考](https://blog.csdn.net/CREATE_17/article/details/104081812?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase）
+ mongo to mysql  [--参考](https://www.cnblogs.com/s6-b/p/11003783.html）


## :bar_chart: grafana